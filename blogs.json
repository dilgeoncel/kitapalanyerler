// Firebase Blog Depolama Sistemi
// 1. Firebase Console'da proje oluÅŸturun: https://console.firebase.google.com
// 2. Firestore Database'i etkinleÅŸtirin
// 3. Web app ekleyin ve config bilgilerini alÄ±n

// Firebase config (Firebase Console'dan alacaÄŸÄ±nÄ±z)
const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT.firebaseapp.com",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_PROJECT.appspot.com",
    messagingSenderId: "123456789",
    appId: "YOUR_APP_ID"
};

// Firebase import (HTML head'e ekleyin)
/*
<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
*/

// Firebase baÅŸlatma
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// Blog yazÄ±sÄ± kaydetme (mevcut handleBlogSubmit fonksiyonunu gÃ¼ncelleyin)
async function saveBlogToFirebase(title, content, imageUrl) {
    try {
        const docRef = await db.collection('blog-posts').add({
            title: title,
            content: content,
            imageUrl: imageUrl || '',
            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
            author: 'Admin'
        });
        
        console.log('Blog yazÄ±sÄ± kaydedildi:', docRef.id);
        return docRef.id;
    } catch (error) {
        console.error('Kaydetme hatasÄ±:', error);
        throw error;
    }
}

// Blog yazÄ±larÄ±nÄ± yÃ¼kleme (sayfa aÃ§Ä±ldÄ±ÄŸÄ±nda Ã§alÄ±ÅŸtÄ±rÄ±n)
async function loadBlogsFromFirebase() {
    try {
        const querySnapshot = await db.collection('blog-posts')
            .orderBy('createdAt', 'desc')
            .get();
        
        const blogPosts = document.getElementById('blog-posts');
        blogPosts.innerHTML = ''; // Mevcut iÃ§eriÄŸi temizle
        
        if (querySnapshot.empty) {
            // BoÅŸ durum mesajÄ± gÃ¶ster
            blogPosts.innerHTML = `
                <div class="empty-state" style="text-align: center; padding: 4rem; color: #7f8c8d;">
                    <h2 style="color: #95a5a6; margin-bottom: 1rem;">ğŸ“š Blog YazÄ±larÄ±</h2>
                    <p>HenÃ¼z blog yazÄ±sÄ± bulunmuyor.</p>
                </div>
            `;
            return;
        }
        
        querySnapshot.forEach((doc) => {
            const data = doc.data();
            const postId = doc.id;
            
            // Blog post HTML'ini oluÅŸtur
            const postDiv = document.createElement('div');
            postDiv.className = 'blog-post';
            postDiv.setAttribute('data-id', postId);
            
            const previewText = data.content.substring(0, 150) + 
                               (data.content.length > 150 ? '...' : '');
            const showReadMore = data.content.length > 150;
            const imageHtml = data.imageUrl ? 
                `<img src="${data.imageUrl}" alt="${data.title}" onclick="openImageModal('${data.imageUrl}', '${data.title}')" title="FotoÄŸrafÄ± bÃ¼yÃ¼tmek iÃ§in tÄ±klayÄ±n">` : '';
            
            postDiv.innerHTML = `
                <div class="blog-post-content">
                    ${imageHtml}
                    <h3>${data.title}</h3>
                    <div class="blog-post-meta">${data.createdAt ? data.createdAt.toDate().toLocaleDateString('tr-TR') : 'Tarih bilinmiyor'} - ${data.author}</div>
                    <p class="blog-preview">${previewText}</p>
                    <div class="full-content" style="display:none;">${data.content}</div>
                    ${showReadMore ? `<a href="#" class="read-more-link" onclick="showFullPost('${postId}'); return false;">DevamÄ±nÄ± Oku &rarr;</a>` : ''}
                </div>
            `;
            
            blogPosts.appendChild(postDiv);
        });
        
    } catch (error) {
        console.error('Blog yÃ¼kleme hatasÄ±:', error);
    }
}

// Blog yazÄ±sÄ± silme
async function deleteBlogFromFirebase(postId) {
    try {
        await db.collection('blog-posts').doc(postId).delete();
        console.log('Blog yazÄ±sÄ± silindi:', postId);
    } catch (error) {
        console.error('Silme hatasÄ±:', error);
        throw error;
    }
}

// Blog yazÄ±sÄ± gÃ¼ncelleme
async function updateBlogInFirebase(postId, title, content, imageUrl) {
    try {
        await db.collection('blog-posts').doc(postId).update({
            title: title,
            content: content,
            imageUrl: imageUrl || '',
            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        console.log('Blog yazÄ±sÄ± gÃ¼ncellendi:', postId);
    } catch (error) {
        console.error('GÃ¼ncelleme hatasÄ±:', error);
        throw error;
    }
}

// Sayfa yÃ¼klendiÄŸinde blog yazÄ±larÄ±nÄ± getir
document.addEventListener('DOMContentLoaded', function() {
    loadBlogsFromFirebase();
});

// GÃ¼ncellenen handleBlogSubmit fonksiyonu
async function handleBlogSubmit() {
    const title = document.getElementById('post-title').value;
    const content = document.getElementById('post-content').value;
    const imageUrl = getCurrentImageSrc();

    if (!title || !content) {
        alert('LÃ¼tfen baÅŸlÄ±k ve iÃ§erik alanlarÄ±nÄ± doldurun!');
        return;
    }

    try {
        // Firebase'e kaydet
        const postId = await saveBlogToFirebase(title, content, imageUrl);
        
        // Formu temizle
        document.getElementById('post-title').value = '';
        document.getElementById('post-content').value = '';
        clearImage();
        
        // SayfayÄ± yenile
        await loadBlogsFromFirebase();
        
        alert('âœ… Blog yazÄ±sÄ± baÅŸarÄ±yla eklendi ve kaydedildi!');
        
    } catch (error) {
        alert('âŒ Blog yazÄ±sÄ± kaydedilirken hata oluÅŸtu: ' + error.message);
    }
}
